
<pre class="background">
<table>
<tbody>
<tr><td class="line_no" line_no="0"></td><td class="code_column">            <span class="comment">// A map of the file name to the content we need to ensure exists in the file</span></td></tr><tr><td class="line_no" line_no="1"></td><td class="code_column">            <span class="keyword">var</span> <span class="blue">filesToWrite</span> = <span class="keyword">new</span> <span class="class">Dictionary</span>&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;(<span class="class">StringComparer</span>.OrdinalIgnoreCase);</td></tr><tr><td class="line_no" line_no="2"></td><td></tr><tr><td class="line_no" line_no="3"></td><td class="code_column">            <span class="comment">// The props we want to be included as early as possible since we want our tasks to be used and</span></td></tr><tr><td class="line_no" line_no="4"></td><td class="code_column">            <span class="comment">// to ensure our setting of targets path happens early enough</span></td></tr><tr><td class="line_no" line_no="5"></td><td class="code_column">            <span class="blue">filesToWrite</span>.<span class="method">Add</span>(<span class="keyword">await</span> <span class="method">GetMSBuildRelativePathAsync</span>(<span class="string">$@&quot;Imports\Microsoft.Common.props\ImportBefore\Roslyn.Compilers.Extension.</span>{hiveName}<span class="string">.props&quot;</span>, <span class="struct">cancellationToken</span>).<span class="method">ConfigureAwait</span>(<span class="keyword">true</span>),</td></tr><tr><td class="line_no" line_no="6"></td><td class="code_column">                <span class="string">$@&quot;&lt;?xml version=&quot;&quot;1.0&quot;&quot; encoding=&quot;&quot;utf-8&quot;&quot;?&gt;</span></td></tr><tr><td class="line_no" line_no="7"></td><td class="code_column"><span class="string">&lt;Project xmlns=&quot;&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;&quot;&gt;</span></td></tr><tr><td class="line_no" line_no="8"></td><td class="code_column">  <span class="string">&lt;PropertyGroup Condition=&quot;&quot;&#39;$(RoslynHive)&#39; == &#39;</span>{hiveName}<span class="string">&#39;&quot;&quot;&gt;</span></td></tr><tr><td class="line_no" line_no="9"></td><td class="code_column">    <span class="string">&lt;CSharpCoreTargetsPath&gt;</span>{packagePath}<span class="string">\Microsoft.CSharp.Core.targets&lt;/CSharpCoreTargetsPath&gt;</span></td></tr><tr><td class="line_no" line_no="10"></td><td class="code_column">    <span class="string">&lt;VisualBasicCoreTargetsPath&gt;</span>{packagePath}<span class="string">\Microsoft.VisualBasic.Core.targets&lt;/VisualBasicCoreTargetsPath&gt;</span></td></tr><tr><td class="line_no" line_no="11"></td><td class="code_column">  <span class="string">&lt;/PropertyGroup&gt;</span> </td></tr><tr><td class="line_no" line_no="12"></td><td class="code_column"><span class="string"></span></td></tr><tr><td class="line_no" line_no="13"></td><td class="code_column">  <span class="string">&lt;UsingTask TaskName=&quot;&quot;Microsoft.CodeAnalysis.BuildTasks.Csc&quot;&quot; AssemblyFile=&quot;&quot;</span>{packagePath}<span class="string">\Microsoft.Build.Tasks.CodeAnalysis.dll&quot;&quot; Condition=&quot;&quot;&#39;$(RoslynHive)&#39; == &#39;</span>{hiveName}<span class="string">&#39;&quot;&quot; /&gt;</span></td></tr><tr><td class="line_no" line_no="14"></td><td class="code_column">  <span class="string">&lt;UsingTask TaskName=&quot;&quot;Microsoft.CodeAnalysis.BuildTasks.Vbc&quot;&quot; AssemblyFile=&quot;&quot;</span>{packagePath}<span class="string">\Microsoft.Build.Tasks.CodeAnalysis.dll&quot;&quot; Condition=&quot;&quot;&#39;$(RoslynHive)&#39; == &#39;</span>{hiveName}<span class="string">&#39;&quot;&quot; /&gt;</span></td></tr><tr><td class="line_no" line_no="15"></td><td class="code_column"><span class="string">&lt;/Project&gt;&quot;</span>);</td></tr><tr><td class="line_no" line_no="16"></td><td></tr><tr><td class="line_no" line_no="17"></td><td class="code_column">            <span class="comment">// This targets content we want to be included later since the project file might touch UseSharedCompilation</span></td></tr><tr><td class="line_no" line_no="18"></td><td class="code_column">            <span class="keyword">var</span> <span class="blue">targetsContent</span> =</td></tr><tr><td class="line_no" line_no="19"></td><td class="code_column">                    <span class="string">$@&quot;&lt;?xml version=&quot;&quot;1.0&quot;&quot; encoding=&quot;&quot;utf-8&quot;&quot;?&gt;</span></td></tr><tr><td class="line_no" line_no="20"></td><td class="code_column"><span class="string">&lt;Project xmlns=&quot;&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;&quot;&gt;</span></td></tr><tr><td class="line_no" line_no="21"></td><td class="code_column">  <span class="string">&lt;!-- If we&#39;re not using the compiler server, set ToolPath/Exe to direct to the exes in this package --&gt;</span></td></tr><tr><td class="line_no" line_no="22"></td><td class="code_column">  <span class="string">&lt;PropertyGroup Condition=&quot;&quot;&#39;$(RoslynHive)&#39; == &#39;</span>{hiveName}<span class="string">&#39; and &#39;$(UseSharedCompilation)&#39; == &#39;false&#39;&quot;&quot;&gt;</span></td></tr><tr><td class="line_no" line_no="23"></td><td class="code_column">    <span class="string">&lt;CscToolPath&gt;</span>{packagePath}<span class="string">&lt;/CscToolPath&gt;</span></td></tr><tr><td class="line_no" line_no="24"></td><td class="code_column">    <span class="string">&lt;CscToolExe&gt;csc.exe&lt;/CscToolExe&gt;</span></td></tr><tr><td class="line_no" line_no="25"></td><td class="code_column">    <span class="string">&lt;VbcToolPath&gt;</span>{packagePath}<span class="string">&lt;/VbcToolPath&gt;</span></td></tr><tr><td class="line_no" line_no="26"></td><td class="code_column">    <span class="string">&lt;VbcToolExe&gt;vbc.exe&lt;/VbcToolExe&gt;</span></td></tr><tr><td class="line_no" line_no="27"></td><td class="code_column">  <span class="string">&lt;/PropertyGroup&gt;</span></td></tr><tr><td class="line_no" line_no="28"></td><td class="code_column"><span class="string">&lt;/Project&gt;&quot;</span>;</td></tr></tbody>
</table></pre>
